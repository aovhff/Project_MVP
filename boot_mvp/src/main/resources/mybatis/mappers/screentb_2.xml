<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.DAO.ScreentbDAO_2">   
    <select id="selecthdr" resultType="com.boot.DTO.ScreentbDTO">
		select areano, theaterno, movieno, movienm
		from
		(
			select a.areano, a.theaterno, a.movieno, b.movienm
			from screentb a
			inner join movietb2 b on (a.movieno = b.movieno)
			group by a.areano, a.theaterno, a.movieno, b.movienm
		) as a
		where areano = #{areano} and theaterno = #{theaterno}
		order by movieno
    </select>
    
    <select id="selecthdrbase" resultType="com.boot.DTO.ScreentbDTO">
		select movieno, movienm
		from
		(
			select a.movieno, b.movienm
			from screentb a
			inner join movietb2 b on (a.movieno = b.movieno)
			group by a.movieno, b.movienm
		) as a
		order by movieno
    </select>
    
    <select id="selectdtl" resultType="com.boot.DTO.ScreentbDTO">
    	select areano, theaterno, movieno, movienm, viewday, roomno, pricetype, starttime, endtime, selecseat, totalseat
		from
		(
			select a.areano, a.theaterno, a.movieno, b.movienm, a.viewday, a.roomno, a.pricetype, a.starttime, a.endtime, a.selecseat, a.totalseat
			from screentb a
			inner join movietb2 b on (a.movieno = b.movieno)
		) as a
		where areano = #{areano} and theaterno = #{theaterno} and movieno = #{movieno} and viewday = #{viewday}
		order by movieno
    </select>
    
    <select id="selectmovieinfo" resultType="com.boot.DTO.ScreentbDTO">
    	select areano, theaterno, theaternm, movieno, movienm, ratingno, 
			   viewday, weekday, roomno, pricetype, nowprice, starttime, endtime, moviepostimg
		from
		(
			select a.areano, a.theaterno, b.theaternm, a.movieno, c.movienm, c.ratingno, a.viewday, 
				   CASE DAYOFWEEK(a.viewday)
						WHEN 1 THEN '일'
						WHEN 2 THEN '월'
						WHEN 3 THEN '화'
						WHEN 4 THEN '수'
						WHEN 5 THEN '목'
						WHEN 6 THEN '금'
						WHEN 7 THEN '토'
					END AS weekday,
					a.roomno, a.pricetype, d.nowprice, a.starttime, a.endtime, c.moviepostimg
			from screentb a
			inner join theatertb b on (a.areano = b.areano and a.theaterno = b.theaterno)
			inner join movietb2 c on (a.movieno = c.movieno)
		    inner join (
		    	select pricetype, nowprice
				from
				(
					select substr(pricetype, 1, 1) as pricetype, nowprice
					from pricetb
				) as a
				group by pricetype, nowprice
		    ) d on (a.pricetype = substr(d.pricetype, 1, 1))
		) as a
		where areano = #{areano} and theaterno = #{theaterno} and movieno = #{movieno} and viewday = #{viewday} and roomno = #{roomno} and starttime = #{starttime}
    </select>
</mapper>
